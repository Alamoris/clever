# Robotex 2019

Robotex International - ежегодное мероприятие и один из крупнейших фестивалей робототехники.

[Официальный сайт](https://robotex.international)

[Репозиторий с кодом](https://github.com/Alamoris/RoboFlow)

## Алгоритм полета по линии

Для обработки изображений используется бибилиотека *OpenCV*.

*ROS* нода обрабатывающая изображения и публикующая полученый угол находится в [файле clever_node.py](https://github.com/Alamoris/RoboFlow/blob/master/clever_node.py).

На вход алгоритма попадает изображение, получаемое из топика `/main_camera/image_raw`, после чего передается в функцию, обрабатывающую его и выдавая на выходе угол(*yaw*), на который должен довернуться коптер в данный момент времени, и сдвиг по оси *y*. Полученные значения публикуются в топик `/robo_flow/debug`, для для последующей обработки. Рассчитанные данные заносятся в *P* регуляторы и далее используются в сервисе `/set_velocity`.

## main_proessing.py

В модуле реализовано 2 основных алгоритма `get_better_yaw` и `get_yaw`, оба алгоритма основаны на обработке бинарной маске с выделенной линией.

### get_yaw

При работе данного алгоритма было совершено допущение, что на обрабатываемой маске находится только выделенная линия. Данное допущение не совсем верно, поскольку в условиях реальной эксплуатации, на полученной маске присутствует множество визуальных шумов, что ухудшает работу алгоритма.

На полученной маске выделяется центральная линия, которая считается центром коптера, относительно этой линии происходит поиск ближайшего и самого верхнего белого пикселя. Также считается, что центр изображения всегда является точной проекцией центра коптера на поверхность снизу, что не верно при полете на больших скоростях, но дает приемлемую погрешность при спокойном полете. Между центральной точкой и точкой найденной на изображении проводится прямая, относительно которой высчитывается угол поворота коптера. Для корректировки по оси *y* также находится точка, самая ближайшая к центру изображения по горизонтальной оси, найденное значение рассчитывается в пикселях.

### get_better_yaw
